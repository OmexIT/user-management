{
    "info": {
        "_postman_id": "e8a9b8e0-5f1d-4f1e-8c8e-5f1d4f1e8c8e",
        "name": "User Management API",
        "description": "A collection for the User Management API with Keycloak integration",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Authentication",
            "item": [
                {
                    "name": "Get Access Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Parse the response JSON",
                                    "var jsonData = pm.response.json();",
                                    "",
                                    "// Store tokens in environment variables if successful",
                                    "if (pm.response.code === 200) {",
                                    "    pm.environment.set(\"access_token\", jsonData.access_token);",
                                    "    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
                                    "    ",
                                    "    // Calculate token expiry time",
                                    "    var expiryDate = new Date();",
                                    "    expiryDate.setSeconds(expiryDate.getSeconds() + jsonData.expires_in);",
                                    "    pm.environment.set(\"token_expiry\", expiryDate.toISOString());",
                                    "    ",
                                    "    console.log(\"Access token stored. Expires at: \" + expiryDate.toISOString());",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/x-www-form-urlencoded"
                            }
                        ],
                        "body": {
                            "mode": "urlencoded",
                            "urlencoded": [
                                {
                                    "key": "grant_type",
                                    "value": "password",
                                    "type": "text"
                                },
                                {
                                    "key": "client_id",
                                    "value": "{{client_id}}",
                                    "type": "text"
                                },
                                {
                                    "key": "client_secret",
                                    "value": "{{client_secret}}",
                                    "type": "text"
                                },
                                {
                                    "key": "username",
                                    "value": "{{username}}",
                                    "type": "text"
                                },
                                {
                                    "key": "password",
                                    "value": "{{password}}",
                                    "type": "text"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{keycloak_url}}/realms/{{keycloak_realm}}/protocol/openid-connect/token",
                            "host": [
                                "{{keycloak_url}}"
                            ],
                            "path": [
                                "realms",
                                "{{keycloak_realm}}",
                                "protocol",
                                "openid-connect",
                                "token"
                            ]
                        },
                        "description": "Get an access token from Keycloak using the password grant type"
                    },
                    "response": []
                },
                {
                    "name": "Refresh Access Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Parse the response JSON",
                                    "var jsonData = pm.response.json();",
                                    "",
                                    "// Store tokens in environment variables if successful",
                                    "if (pm.response.code === 200) {",
                                    "    pm.environment.set(\"access_token\", jsonData.access_token);",
                                    "    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
                                    "    ",
                                    "    // Calculate token expiry time",
                                    "    var expiryDate = new Date();",
                                    "    expiryDate.setSeconds(expiryDate.getSeconds() + jsonData.expires_in);",
                                    "    pm.environment.set(\"token_expiry\", expiryDate.toISOString());",
                                    "    ",
                                    "    console.log(\"Access token refreshed. Expires at: \" + expiryDate.toISOString());",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/x-www-form-urlencoded"
                            }
                        ],
                        "body": {
                            "mode": "urlencoded",
                            "urlencoded": [
                                {
                                    "key": "grant_type",
                                    "value": "refresh_token",
                                    "type": "text"
                                },
                                {
                                    "key": "client_id",
                                    "value": "{{client_id}}",
                                    "type": "text"
                                },
                                {
                                    "key": "client_secret",
                                    "value": "{{client_secret}}",
                                    "type": "text"
                                },
                                {
                                    "key": "refresh_token",
                                    "value": "{{refresh_token}}",
                                    "type": "text"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{keycloak_url}}/realms/{{keycloak_realm}}/protocol/openid-connect/token",
                            "host": [
                                "{{keycloak_url}}"
                            ],
                            "path": [
                                "realms",
                                "{{keycloak_realm}}",
                                "protocol",
                                "openid-connect",
                                "token"
                            ]
                        },
                        "description": "Refresh an access token using the refresh token"
                    },
                    "response": []
                }
            ],
            "description": "Endpoints for authentication with Keycloak"
        },
        {
            "name": "User Management",
            "item": [
                {
                    "name": "Get Current User",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/me",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "me"
                            ]
                        },
                        "description": "Get information about the current authenticated user"
                    },
                    "response": []
                },
                {
                    "name": "Get User By External ID",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/admin/users/{{external_user_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "admin",
                                "users",
                                "{{external_user_id}}"
                            ]
                        },
                        "description": "Get information about a specific user by their external ID (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Check Permission",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/permissions/check?permission=READ:RESOURCE",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "permissions",
                                "check"
                            ],
                            "query": [
                                {
                                    "key": "permission",
                                    "value": "READ:RESOURCE"
                                }
                            ]
                        },
                        "description": "Check if the current user has a specific permission"
                    },
                    "response": []
                }
            ],
            "description": "Endpoints for user-related operations"
        },
        {
            "name": "Role Management",
            "item": [
                {
                    "name": "Get All Roles",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/admin/roles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "admin",
                                "roles"
                            ]
                        },
                        "description": "Get all roles (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Get Role",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/admin/roles/{{role_name}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "admin",
                                "roles",
                                "{{role_name}}"
                            ]
                        },
                        "description": "Get a specific role by name (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Create Role",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"new-role\",\n    \"description\": \"A new role\",\n    \"permissions\": [\n        \"READ:RESOURCE\",\n        \"WRITE:RESOURCE\"\n    ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/admin/roles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "admin",
                                "roles"
                            ]
                        },
                        "description": "Create a new role (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Get Role Permissions",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/admin/roles/{{role_name}}/permissions",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "admin",
                                "roles",
                                "{{role_name}}",
                                "permissions"
                            ]
                        },
                        "description": "Get permissions for a specific role (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Add Permissions to Role",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "[\n    \"READ:RESOURCE\",\n    \"WRITE:RESOURCE\",\n    \"DELETE:RESOURCE\"\n]"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/admin/roles/{{role_name}}/permissions",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "admin",
                                "roles",
                                "{{role_name}}",
                                "permissions"
                            ]
                        },
                        "description": "Add permissions to a specific role (admin only)"
                    },
                    "response": []
                }
            ],
            "description": "Endpoints for role management operations"
        },
        {
            "name": "Merchant Management",
            "item": [
                {
                    "name": "Create Merchant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Store merchant ID in environment variable if successful",
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.environment.set(\"merchant_id\", jsonData.id);",
                                    "    pm.environment.set(\"merchant_code\", jsonData.merchantCode);",
                                    "    console.log(\"Stored merchant_id: \" + jsonData.id);",
                                    "    console.log(\"Stored merchant_code: \" + jsonData.merchantCode);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"merchantCode\": \"MERCH001\",\n    \"businessName\": \"Example Merchant\",\n    \"status\": \"ACTIVE\",\n    \"initialUser\": {\n        \"email\": \"merchant@example.com\",\n        \"displayName\": \"Merchant Admin\"\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/merchants",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "merchants"
                            ]
                        },
                        "description": "Create a new merchant with initial user (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Get All Merchants",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/merchants",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "merchants"
                            ]
                        },
                        "description": "Get all merchants (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Get Merchant by ID",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/merchants/{{merchant_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "merchants",
                                "{{merchant_id}}"
                            ]
                        },
                        "description": "Get merchant by ID (admin or merchant)"
                    },
                    "response": []
                },
                {
                    "name": "Get Merchant by Code",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/merchants/code/{{merchant_code}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "merchants",
                                "code",
                                "{{merchant_code}}"
                            ]
                        },
                        "description": "Get merchant by code (admin or merchant)"
                    },
                    "response": []
                },
                {
                    "name": "Update Merchant",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"businessName\": \"Updated Merchant Name\",\n    \"status\": \"ACTIVE\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/merchants/{{merchant_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "merchants",
                                "{{merchant_id}}"
                            ]
                        },
                        "description": "Update merchant details (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Add User to Merchant",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"merchantId\": {{merchant_id}},\n    \"role\": \"OPERATOR\",\n    \"user\": {\n        \"email\": \"merchant-operator@example.com\",\n        \"displayName\": \"Merchant Operator\"\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/merchants/{{merchant_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "merchants",
                                "{{merchant_id}}",
                                "users"
                            ]
                        },
                        "description": "Add a user to a merchant (admin or merchant admin)"
                    },
                    "response": []
                }
            ],
            "description": "Endpoints for merchant management operations"
        },
        {
            "name": "Customer Management",
            "item": [
                {
                    "name": "Create Customer",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Store customer ID in environment variable if successful",
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.environment.set(\"customer_id\", jsonData.id);",
                                    "    pm.environment.set(\"customer_number\", jsonData.customerNumber);",
                                    "    console.log(\"Stored customer_id: \" + jsonData.id);",
                                    "    console.log(\"Stored customer_number: \" + jsonData.customerNumber);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"customerNumber\": \"CUST001\",\n    \"name\": \"Example Customer\",\n    \"type\": \"INDIVIDUAL\",\n    \"user\": {\n        \"email\": \"customer@example.com\",\n        \"displayName\": \"Customer User\"\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/customers",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers"
                            ]
                        },
                        "description": "Create a new customer with user (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Get All Customers",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/customers",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers"
                            ]
                        },
                        "description": "Get all customers (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Get Customer by ID",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/customers/{{customer_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers",
                                "{{customer_id}}"
                            ]
                        },
                        "description": "Get customer by ID (admin or customer)"
                    },
                    "response": []
                },
                {
                    "name": "Get Customer by Number",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/customers/number/{{customer_number}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers",
                                "number",
                                "{{customer_number}}"
                            ]
                        },
                        "description": "Get customer by number (admin or customer)"
                    },
                    "response": []
                },
                {
                    "name": "Get Customer by User ID",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/customers/user/{{user_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers",
                                "user",
                                "{{user_id}}"
                            ]
                        },
                        "description": "Get customer by user ID (admin or customer)"
                    },
                    "response": []
                },
                {
                    "name": "Update Customer",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Customer Name\",\n    \"type\": \"INDIVIDUAL\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/customers/{{customer_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers",
                                "{{customer_id}}"
                            ]
                        },
                        "description": "Update customer details (admin only)"
                    },
                    "response": []
                },
                {
                    "name": "Customer Dashboard",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{access_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/customers/dashboard",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "customers",
                                "dashboard"
                            ]
                        },
                        "description": "Customer dashboard endpoint (customer only)"
                    },
                    "response": []
                }
            ],
            "description": "Endpoints for customer management operations"
        }
    ]
}